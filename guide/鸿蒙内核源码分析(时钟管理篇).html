<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>鸿蒙内核源码注释中文版 | 深挖内核地基工程</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="鸿蒙内核源码注释中文版 | 深挖内核地基工程">
    
    <link rel="preload" href="/assets/css/0.styles.fab77d47.css" as="style"><link rel="preload" href="/assets/js/app.4cae8ba0.js" as="script"><link rel="preload" href="/assets/js/2.116766d4.js" as="script"><link rel="preload" href="/assets/js/19.6a817187.js" as="script"><link rel="prefetch" href="/assets/js/10.e6b5d356.js"><link rel="prefetch" href="/assets/js/11.c5c8ea94.js"><link rel="prefetch" href="/assets/js/12.de5ecdee.js"><link rel="prefetch" href="/assets/js/13.3354c84c.js"><link rel="prefetch" href="/assets/js/14.0c31f03f.js"><link rel="prefetch" href="/assets/js/15.354be65c.js"><link rel="prefetch" href="/assets/js/16.f8821cc3.js"><link rel="prefetch" href="/assets/js/17.71ed0002.js"><link rel="prefetch" href="/assets/js/18.84412a2f.js"><link rel="prefetch" href="/assets/js/20.b6883036.js"><link rel="prefetch" href="/assets/js/21.4d38230c.js"><link rel="prefetch" href="/assets/js/22.5e9a0cfe.js"><link rel="prefetch" href="/assets/js/23.5b2b0ff6.js"><link rel="prefetch" href="/assets/js/24.547a7276.js"><link rel="prefetch" href="/assets/js/25.32a2c33a.js"><link rel="prefetch" href="/assets/js/26.0b4304e8.js"><link rel="prefetch" href="/assets/js/27.7d963792.js"><link rel="prefetch" href="/assets/js/3.8d4ce837.js"><link rel="prefetch" href="/assets/js/4.17793416.js"><link rel="prefetch" href="/assets/js/5.c677297e.js"><link rel="prefetch" href="/assets/js/6.3d7fe4d3.js"><link rel="prefetch" href="/assets/js/7.f53ef249.js"><link rel="prefetch" href="/assets/js/8.87baa4ab.js"><link rel="prefetch" href="/assets/js/9.7f9d6034.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fab77d47.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">鸿蒙内核源码注释中文版 | 深挖内核地基工程</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">代码仓库</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">代码仓库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/weharmony/kernel_liteos_a_note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee仓
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/kuangyufei/kernel_liteos_a_note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github仓
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://codechina.csdn.net/kuangyufei/kernel_liteos_a_note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN仓
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://weharmony.coding.net/public/harmony/kernel_liteos_a_note/git/files" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Coding仓
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">博文地址</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">博文地址</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/kuangyufei/article/details/108727970" target="_blank" rel="noopener noreferrer" class="nav-link external">
  csdn
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://my.oschina.net/u/3751245/blog/4626852" target="_blank" rel="noopener noreferrer" class="nav-link external">
  oschina
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">代码仓库</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">代码仓库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/weharmony/kernel_liteos_a_note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee仓
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/kuangyufei/kernel_liteos_a_note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github仓
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://codechina.csdn.net/kuangyufei/kernel_liteos_a_note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN仓
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://weharmony.coding.net/public/harmony/kernel_liteos_a_note/git/files" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Coding仓
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">博文地址</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">博文地址</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/kuangyufei/article/details/108727970" target="_blank" rel="noopener noreferrer" class="nav-link external">
  csdn
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://my.oschina.net/u/3751245/blog/4626852" target="_blank" rel="noopener noreferrer" class="nav-link external">
  oschina
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="content__default"><p><a href="https://gitee.com/weharmony/kernel_liteos_a_note" target="_blank" rel="noopener noreferrer">鸿蒙内核源码注释中文版 【 Gitee仓 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>|<a href="https://codechina.csdn.net/kuangyufei/kernel_liteos_a_note" target="_blank" rel="noopener noreferrer"> CSDN仓 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>|<a href="https://github.com/kuangyufei/kernel_liteos_a_note" target="_blank" rel="noopener noreferrer"> Github仓 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>|<a href="https://weharmony.coding.net/public/harmony/kernel_liteos_a_note/git/files" target="_blank" rel="noopener noreferrer"> Coding仓 】<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>精读内核源码,中文详细注解.深挖地基工程,构建底层网图.</p> <p><a href="https://blog.csdn.net/kuangyufei/article/details/108727970" target="_blank" rel="noopener noreferrer">鸿蒙源码分析系列篇 【 CSDN <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://my.oschina.net/u/3751245/blog/4626852" target="_blank" rel="noopener noreferrer">| OSCHINA <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://gitee.com/weharmony/kernel_liteos_a_note/wikis/pages" target="_blank" rel="noopener noreferrer">| WIKI 】<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>问答式导读, 生活式比喻, 图形化展示, 层层剥开内核神秘外衣.</p> <hr> <p><strong><a href="https://my.oschina.net/u/3751245/blog/4869137" target="_blank" rel="noopener noreferrer">内核代码详细结构 &gt;&gt; 进入阅读代码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p> <p><strong>目录</strong></p> <p><a href="#%E5%A4%9A%E4%B9%85Tick%E4%B8%80%E6%AC%A1%EF%BC%9F">多久Tick一次？看代码</a></p> <p><a href="#%E5%9C%A8%E5%93%AA%E9%87%8C%E8%AE%BE%E7%BD%AEtick%E7%9A%84%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%EF%BC%9F">在哪里设置tick的回调函数？</a></p> <p><a href="#OsTaskScan()">OsTaskScan()</a></p> <p><a href="#%E9%99%A4%E4%BA%86tick%C2%A0%E4%BC%9A%E8%A7%A6%E5%8F%91%E8%B0%83%E5%BA%A6%EF%BC%8C%E8%BF%98%E6%9C%89%E5%93%AA%E4%BA%9B%E6%83%85%E5%86%B5%E4%BC%9A%E8%A7%A6%E5%8F%91%E8%B0%83%E5%BA%A6%EF%BC%9F">除了tick 会触发调度，还有哪些情况会触发调度？</a></p> <p>时钟管理模块很简单，但有内核重要的代码 OsTickHandler()，这是干嘛的，可以理解为 JAVA的定时任务，但这是系统内核的定时器。因鸿蒙目前开放的是 轻量级的内核 lite os (LOS)，所以tick的频率不会太高</p> <p>对应张大爷的故事：很简单就是场馆的那个大钟，很准时, 每10分响一次，一次就是一个Tick(节拍)</p> <h2 id="多久tick一次-看代码"><a href="#多久tick一次-看代码" class="header-anchor">#</a> 多久Tick一次？看代码</h2> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/**
 * @ingroup los_config
 * Number of Ticks in one second
 */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">LOSCFG_BASE_CORE_TICK_PER_SECOND</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LOSCFG_BASE_CORE_TICK_PER_SECOND</span> <span class="token expression"><span class="token number">100</span> </span><span class="token comment">//默认每秒100次触发，当然这是可以改的</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>



</code></pre></div><p>每秒100 tick ，即每秒100次调用时钟中断处理程序, 时间片单位为10ms</p> <p>一次任务分配多少时间给进程执行呢？答案是 2个时间片，即 20ms</p> <p>对应张大爷的故事：节目喊到后这次进来的总表演时间，10分钟一个时间片，共2片，表演20分钟。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/**
 * @ingroup los_config
 * Longest execution time of tasks with the same priorities
 */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">LOSCFG_BASE_CORE_TIMESLICE_TIMEOUT</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LOSCFG_BASE_CORE_TIMESLICE_TIMEOUT</span> <span class="token expression"><span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">/**
 * @ingroup los_process
 * Hold the time slice process
 */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OS_PROCESS_SCHED_RR_INTERVAL</span>     <span class="token expression">LOSCFG_BASE_CORE_TIMESLICE_TIMEOUT</span></span>


</code></pre></div><p>用完需要可以再分配，但一次就是只给2个时间片，怕你一直占着茅坑，后面还有人在等的.详细代码： OsSchedResched(VOID)</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//重新调度实现</span>
VOID <span class="token function">OsSchedResched</span><span class="token punctuation">(</span>VOID<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    LosTaskCB <span class="token operator">*</span>runTask <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    LosTaskCB <span class="token operator">*</span>newTask <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    LosProcessCB <span class="token operator">*</span>runProcess <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    LosProcessCB <span class="token operator">*</span>newProcess <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

    <span class="token function">LOS_ASSERT</span><span class="token punctuation">(</span><span class="token function">LOS_SpinHeld</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>g_taskSpin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//必须持有任务自旋锁,自旋锁是不是进程层面去抢锁,而是CPU各自核之间去争夺锁</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">OsPreemptableInSched</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//是否置了重新调度标识位</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    runTask <span class="token operator">=</span> <span class="token function">OsCurrTaskGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取当前任务</span>
    newTask <span class="token operator">=</span> <span class="token function">OsGetTopTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取优先级最最最高的任务</span>

    <span class="token comment">/* always be able to get one task */</span>
    <span class="token function">LOS_ASSERT</span><span class="token punctuation">(</span>newTask <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不能没有需调度的任务</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>runTask <span class="token operator">==</span> newTask<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//当前任务就是最高任务,那还调度个啥的,直接退出.</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    runTask<span class="token operator">-&gt;</span>taskStatus <span class="token operator">&amp;=</span> <span class="token operator">~</span>OS_TASK_STATUS_RUNNING<span class="token punctuation">;</span><span class="token comment">//当前任务状态位置成不在运行状态</span>
    newTask<span class="token operator">-&gt;</span>taskStatus <span class="token operator">|=</span> OS_TASK_STATUS_RUNNING<span class="token punctuation">;</span><span class="token comment">//最高任务状态位置成在运行状态</span>

    runProcess <span class="token operator">=</span> <span class="token function">OS_PCB_FROM_PID</span><span class="token punctuation">(</span>runTask<span class="token operator">-&gt;</span>processID<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//通过进程ID索引拿到进程实体</span>
    newProcess <span class="token operator">=</span> <span class="token function">OS_PCB_FROM_PID</span><span class="token punctuation">(</span>newTask<span class="token operator">-&gt;</span>processID<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//同上</span>

    <span class="token function">OsSchedSwitchProcess</span><span class="token punctuation">(</span>runProcess<span class="token punctuation">,</span> newProcess<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//切换进程,里面主要涉及进程空间的切换,也就是MMU的上下文切换.</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>LOSCFG_KERNEL_SMP <span class="token operator">==</span> YES<span class="token punctuation">)</span></span><span class="token comment">//CPU多核的情况</span></span>
    <span class="token comment">/* mask new running task's owner processor */</span>
    runTask<span class="token operator">-&gt;</span>currCpu <span class="token operator">=</span> OS_TASK_INVALID_CPUID<span class="token punctuation">;</span><span class="token comment">//当前任务不占用CPU</span>
    newTask<span class="token operator">-&gt;</span>currCpu <span class="token operator">=</span> <span class="token function">ArchCurrCpuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//让新任务占用CPU</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

    <span class="token punctuation">(</span>VOID<span class="token punctuation">)</span><span class="token function">OsTaskSwitchCheck</span><span class="token punctuation">(</span>runTask<span class="token punctuation">,</span> newTask<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//切换task的检查</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>LOSCFG_KERNEL_SCHED_STATISTICS <span class="token operator">==</span> YES<span class="token punctuation">)</span></span></span>
    <span class="token function">OsSchedStatistics</span><span class="token punctuation">(</span>runTask<span class="token punctuation">,</span> newTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>newTask<span class="token operator">-&gt;</span>timeSlice <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>newTask<span class="token operator">-&gt;</span>policy <span class="token operator">==</span> LOS_SCHED_RR<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//没有时间片且是抢占式调度的方式,注意 非抢占式都不需要时间片的.</span>
        newTask<span class="token operator">-&gt;</span>timeSlice <span class="token operator">=</span> LOSCFG_BASE_CORE_TIMESLICE_TIMEOUT<span class="token punctuation">;</span><span class="token comment">//给新任务时间片 默认 20ms</span>
    <span class="token punctuation">}</span>

    <span class="token function">OsCurrTaskSet</span><span class="token punctuation">(</span><span class="token punctuation">(</span>VOID<span class="token operator">*</span><span class="token punctuation">)</span>newTask<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置新的task为CPU核的当前任务</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">OsProcessIsUserMode</span><span class="token punctuation">(</span>newProcess<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//用户模式下会怎么样?</span>
        <span class="token function">OsCurrUserTaskSet</span><span class="token punctuation">(</span>newTask<span class="token operator">-&gt;</span>userArea<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置task栈空间</span>
    <span class="token punctuation">}</span>

    <span class="token function">PRINT_TRACE</span><span class="token punctuation">(</span><span class="token string">&quot;cpu%d run process name: (%s) pid: %d status: %x threadMap: %x task name: (%s) tid: %d status: %x -&gt;\n&quot;</span>
                <span class="token string">&quot;     new process name: (%s) pid: %d status: %x threadMap: %x task name: (%s) tid: %d status: %x!\n&quot;</span><span class="token punctuation">,</span>
                <span class="token function">ArchCurrCpuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                runProcess<span class="token operator">-&gt;</span>processName<span class="token punctuation">,</span> runProcess<span class="token operator">-&gt;</span>processID<span class="token punctuation">,</span> runProcess<span class="token operator">-&gt;</span>processStatus<span class="token punctuation">,</span>
                runProcess<span class="token operator">-&gt;</span>threadScheduleMap<span class="token punctuation">,</span> runTask<span class="token operator">-&gt;</span>taskName<span class="token punctuation">,</span>  runTask<span class="token operator">-&gt;</span>taskID<span class="token punctuation">,</span> runTask<span class="token operator">-&gt;</span>taskStatus<span class="token punctuation">,</span>
                newProcess<span class="token operator">-&gt;</span>processName<span class="token punctuation">,</span> newProcess<span class="token operator">-&gt;</span>processID<span class="token punctuation">,</span> newProcess<span class="token operator">-&gt;</span>processStatus<span class="token punctuation">,</span>
                newProcess<span class="token operator">-&gt;</span>threadScheduleMap<span class="token punctuation">,</span> newTask<span class="token operator">-&gt;</span>taskName<span class="token punctuation">,</span> newTask<span class="token operator">-&gt;</span>taskID<span class="token punctuation">,</span> newTask<span class="token operator">-&gt;</span>taskStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* do the task context switch */</span>
    <span class="token function">OsTaskSchedule</span><span class="token punctuation">(</span>newTask<span class="token punctuation">,</span> runTask<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//再执行调度,主要是切换CPU的上下文</span>
<span class="token punctuation">}</span>



</code></pre></div><h2 id="在哪里设置tick的回调函数"><a href="#在哪里设置tick的回调函数" class="header-anchor">#</a> 在哪里设置tick的回调函数？</h2> <p>从main中可以看到tick 的初始化和中断服务程序的注册</p> <p><img src="https://img-blog.csdnimg.cn/20200915170002382.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2t1YW5neXVmZWk=,size_16,color_FFFFFF,t_70" alt=""></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// 中断处理函数</span>
VOID <span class="token function">OsTickEntry</span><span class="token punctuation">(</span>VOID<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">OsTickHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//最最关键函数</span>

    <span class="token comment">/* clear private timer */</span>
    g_privateTimer<span class="token operator">-&gt;</span>intStatus <span class="token operator">=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// 由 main 函数调用，注册中断处理函数 OsTickEntry</span>
VOID <span class="token function">HalClockInit</span><span class="token punctuation">(</span>VOID<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    UINT32 ret<span class="token punctuation">;</span>

    ret <span class="token operator">=</span>  <span class="token function">LOS_HwiCreate</span><span class="token punctuation">(</span>PRVTIMER_INT_NUM<span class="token punctuation">,</span> <span class="token number">0xa0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> OsTickEntry<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">!=</span> LOS_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">PRINT_ERR</span><span class="token punctuation">(</span><span class="token string">&quot;%s, %d create tick irq failed, ret:0x%x\n&quot;</span><span class="token punctuation">,</span> __FUNCTION__<span class="token punctuation">,</span> <span class="token constant">__LINE__</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre></div><p>OsTickHandler 是tick 的中断处理程序，其中完成了时间片的检查和任务的扫描。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/*
 * Description : Tick interruption handler
 */</span><span class="token comment">//系统时钟中断处理函数 ,鸿蒙是 10ms触发一次</span>
LITE_OS_SEC_TEXT VOID <span class="token function">OsTickHandler</span><span class="token punctuation">(</span>VOID<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    UINT32 intSave<span class="token punctuation">;</span>

    <span class="token function">TICK_LOCK</span><span class="token punctuation">(</span>intSave<span class="token punctuation">)</span><span class="token punctuation">;</span>
    g_tickCount<span class="token punctuation">[</span><span class="token function">ArchCurrCpuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">//当前CPU核 计数器</span>
    <span class="token function">TICK_UNLOCK</span><span class="token punctuation">(</span>intSave<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">LOSCFG_KERNEL_VDSO</span></span>
    <span class="token function">OsUpdateVdsoTimeval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">LOSCFG_KERNEL_TICKLESS</span></span>
    <span class="token function">OsTickIrqFlagSet</span><span class="token punctuation">(</span><span class="token function">OsTicklessFlagGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>LOSCFG_BASE_CORE_TICK_HW_TIME <span class="token operator">==</span> YES<span class="token punctuation">)</span></span></span>
    <span class="token function">HalClockIrqClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* diff from every platform */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

    <span class="token function">OsTimesliceCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//时间片检查</span>

    <span class="token function">OsTaskScan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* task timeout scan */</span><span class="token comment">//任务扫描</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>LOSCFG_BASE_CORE_SWTMR <span class="token operator">==</span> YES<span class="token punctuation">)</span></span></span>
    <span class="token function">OsSwtmrScan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//定时器扫描,看是否有超时的定时器</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token punctuation">}</span>



</code></pre></div><div class="language-cpp extra-class"><pre class="language-cpp"><code>LITE_OS_SEC_TEXT VOID <span class="token function">OsTimesliceCheck</span><span class="token punctuation">(</span>VOID<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    LosTaskCB <span class="token operator">*</span>runTask <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    LosProcessCB <span class="token operator">*</span>runProcess <span class="token operator">=</span> <span class="token function">OsCurrProcessGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>runProcess<span class="token operator">-&gt;</span>policy <span class="token operator">!=</span> LOS_SCHED_RR<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">goto</span> SCHED_TASK<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>runProcess<span class="token operator">-&gt;</span>timeSlice <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        runProcess<span class="token operator">-&gt;</span>timeSlice<span class="token operator">--</span><span class="token punctuation">;</span><span class="token comment">//进程时间片减少一次</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>runProcess<span class="token operator">-&gt;</span>timeSlice <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">LOS_Schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//进程时间片用完,发起调度</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

SCHED_TASK<span class="token operator">:</span>
    runTask <span class="token operator">=</span> <span class="token function">OsCurrTaskGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>runTask<span class="token operator">-&gt;</span>policy <span class="token operator">!=</span> LOS_SCHED_RR<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>runTask<span class="token operator">-&gt;</span>timeSlice <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        runTask<span class="token operator">-&gt;</span>timeSlice<span class="token operator">--</span><span class="token punctuation">;</span><span class="token comment">//对应任务时间片也减少一次</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>runTask<span class="token operator">-&gt;</span>timeSlice <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">LOS_Schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>



</code></pre></div><h2 id="ostaskscan"><a href="#ostaskscan" class="header-anchor">#</a> OsTaskScan()</h2> <p>OsTaskScan()不断查task的状态，有任务就去执行，毫不夸张的可以说是 进程有序执行的源动力之所在！</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">//任务扫描处理,注意这个函数只有 时钟中断处理函数OsTickHandler调用,非常稳定.所以游标每次进来都+1对应一个tick</span>
LITE_OS_SEC_TEXT VOID <span class="token function">OsTaskScan</span><span class="token punctuation">(</span>VOID<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    SortLinkList <span class="token operator">*</span>sortList <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    LosTaskCB <span class="token operator">*</span>taskCB <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    BOOL needSchedule <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
    UINT16 tempStatus<span class="token punctuation">;</span>
    LOS_DL_LIST <span class="token operator">*</span>listObject <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    SortLinkAttribute <span class="token operator">*</span>taskSortLink <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

    taskSortLink <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token function">OsPercpuGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>taskSortLink<span class="token punctuation">;</span><span class="token comment">//获取任务的排序链表</span>
    taskSortLink<span class="token operator">-&gt;</span>cursor <span class="token operator">=</span> <span class="token punctuation">(</span>taskSortLink<span class="token operator">-&gt;</span>cursor <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> OS_TSK_SORTLINK_MASK<span class="token punctuation">;</span>
    listObject <span class="token operator">=</span> taskSortLink<span class="token operator">-&gt;</span>sortLink <span class="token operator">+</span> taskSortLink<span class="token operator">-&gt;</span>cursor<span class="token punctuation">;</span><span class="token comment">//只处理这个游标上的链表,因为系统对超时任务都已经规链表了.</span>
    <span class="token comment">//当任务因超时而挂起时，任务块处于超时排序链接上,（每个cpu）和ipc（互斥锁、扫描电镜等）的块同时被唤醒</span>
    <span class="token comment">/*不管是超时还是相应的ipc，它都在等待。现在使用synchronize sortlink precedure，因此整个任务扫描需要保护，防止另一个核心同时删除sortlink。
     * When task is pended with timeout, the task block is on the timeout sortlink
     * (per cpu) and ipc(mutex,sem and etc.)'s block at the same time, it can be waken
     * up by either timeout or corresponding ipc it's waiting.
     *
     * Now synchronize sortlink preocedure is used, therefore the whole task scan needs
     * to be protected, preventing another core from doing sortlink deletion at same time.
     */</span>
    <span class="token function">LOS_SpinLock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>g_taskSpin<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">LOS_ListEmpty</span><span class="token punctuation">(</span>listObject<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">LOS_SpinUnlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>g_taskSpin<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    sortList <span class="token operator">=</span> <span class="token function">LOS_DL_LIST_ENTRY</span><span class="token punctuation">(</span>listObject<span class="token operator">-&gt;</span>pstNext<span class="token punctuation">,</span> SortLinkList<span class="token punctuation">,</span> sortLinkNode<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//拿本次Tick对应链表的SortLinkList的第一个节点sortLinkNode</span>
    <span class="token function">ROLLNUM_DEC</span><span class="token punctuation">(</span>sortList<span class="token operator">-&gt;</span>idxRollNum<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//滚动数--</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">ROLLNUM</span><span class="token punctuation">(</span>sortList<span class="token operator">-&gt;</span>idxRollNum<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//找到时间到了节点,注意这些节点都是由定时器产生的,</span>
        <span class="token function">LOS_ListDelete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sortList<span class="token operator">-&gt;</span>sortLinkNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        taskCB <span class="token operator">=</span> <span class="token function">LOS_DL_LIST_ENTRY</span><span class="token punctuation">(</span>sortList<span class="token punctuation">,</span> LosTaskCB<span class="token punctuation">,</span> sortList<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//拿任务,这里的任务都是超时任务</span>
        taskCB<span class="token operator">-&gt;</span>taskStatus <span class="token operator">&amp;=</span> <span class="token operator">~</span>OS_TASK_STATUS_PEND_TIME<span class="token punctuation">;</span>
        tempStatus <span class="token operator">=</span> taskCB<span class="token operator">-&gt;</span>taskStatus<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tempStatus <span class="token operator">&amp;</span> OS_TASK_STATUS_PEND<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            taskCB<span class="token operator">-&gt;</span>taskStatus <span class="token operator">&amp;=</span> <span class="token operator">~</span>OS_TASK_STATUS_PEND<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>LOSCFG_KERNEL_LITEIPC <span class="token operator">==</span> YES<span class="token punctuation">)</span></span></span>
            taskCB<span class="token operator">-&gt;</span>ipcStatus <span class="token operator">&amp;=</span> <span class="token operator">~</span>IPC_THREAD_STATUS_PEND<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
            taskCB<span class="token operator">-&gt;</span>taskStatus <span class="token operator">|=</span> OS_TASK_STATUS_TIMEOUT<span class="token punctuation">;</span>
            <span class="token function">LOS_ListDelete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>taskCB<span class="token operator">-&gt;</span>pendList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            taskCB<span class="token operator">-&gt;</span>taskSem <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
            taskCB<span class="token operator">-&gt;</span>taskMux <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            taskCB<span class="token operator">-&gt;</span>taskStatus <span class="token operator">&amp;=</span> <span class="token operator">~</span>OS_TASK_STATUS_DELAY<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>tempStatus <span class="token operator">&amp;</span> OS_TASK_STATUS_SUSPEND<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">OS_TASK_SCHED_QUEUE_ENQUEUE</span><span class="token punctuation">(</span>taskCB<span class="token punctuation">,</span> OS_PROCESS_STATUS_PEND<span class="token punctuation">)</span><span class="token punctuation">;</span>
            needSchedule <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">LOS_ListEmpty</span><span class="token punctuation">(</span>listObject<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        sortList <span class="token operator">=</span> <span class="token function">LOS_DL_LIST_ENTRY</span><span class="token punctuation">(</span>listObject<span class="token operator">-&gt;</span>pstNext<span class="token punctuation">,</span> SortLinkList<span class="token punctuation">,</span> sortLinkNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">LOS_SpinUnlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>g_taskSpin<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>needSchedule <span class="token operator">!=</span> FALSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">LOS_MpSchedule</span><span class="token punctuation">(</span>OS_MP_CPU_ALL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">LOS_Schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre></div><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=""><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=""></p> <p>以上代码对应张大爷的故事: 钟声一响起张大爷起身去查 节目时间用完没有，没用完继续你的表演，用完了去外面重新排队，大爷再从外面选一个优先级最高的节目进来表演，就这么简单！除了钟响大爷去工作之外，还有什么情况能让大爷不要偷懒，起来走两步呢？</p> <h2 id="除了tick-会触发调度-还有哪些情况会触发调度"><a href="#除了tick-会触发调度-还有哪些情况会触发调度" class="header-anchor">#</a> 除了tick 会触发调度，还有哪些情况会触发调度？</h2> <p><a href="https://gitee.com/weharmony/kernel_liteos_a_note" target="_blank" rel="noopener noreferrer"><img src="https://gitee.com/weharmony/kernel_liteos_a_note/widgets/widget_card.svg?colors=4183c4,ffffff,ffffff,e3e9ed,666666,9b9b9b" alt="WeHarmony/kernel_liteos_a_note"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="喜欢就关注下吧-您的关注真的很重要"><a href="#喜欢就关注下吧-您的关注真的很重要" class="header-anchor">#</a> <strong>喜欢就关注下吧,您的关注真的很重要</strong></h3> <p><img src="https://gitee.com/weharmony/kernel_liteos_a_note/raw/master/zzz/pic/other/wxcode.png" alt="在这里插入图片描述"></p> <p>作者邮箱:weharmony@126.com</p> <hr> <p><a href="https://gitee.com/weharmony/kernel_liteos_a_note" target="_blank" rel="noopener noreferrer">鸿蒙内核源码注释中文版 【 Gitee仓 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>|<a href="https://codechina.csdn.net/kuangyufei/kernel_liteos_a_note" target="_blank" rel="noopener noreferrer"> CSDN仓 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>|<a href="https://github.com/kuangyufei/kernel_liteos_a_note" target="_blank" rel="noopener noreferrer"> Github仓 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>|<a href="https://weharmony.coding.net/public/harmony/kernel_liteos_a_note/git/files" target="_blank" rel="noopener noreferrer"> Coding仓 】<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>精读内核源码,中文详细注解.深挖地基工程,构建底层网图.</p> <p><a href="https://blog.csdn.net/kuangyufei/article/details/108727970" target="_blank" rel="noopener noreferrer">鸿蒙源码分析系列篇 【 CSDN <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://my.oschina.net/u/3751245/blog/4626852" target="_blank" rel="noopener noreferrer">| OSCHINA <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://gitee.com/weharmony/kernel_liteos_a_note/wikis/pages" target="_blank" rel="noopener noreferrer">| WIKI 】<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>问答式导读, 生活式比喻, 图形化展示, 层层剥开内核神秘外衣.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4cae8ba0.js" defer></script><script src="/assets/js/2.116766d4.js" defer></script><script src="/assets/js/19.6a817187.js" defer></script>
  </body>
</html>
